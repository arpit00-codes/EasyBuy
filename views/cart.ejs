<%- include('./partials/header') %>

<% if (!user.cart || user.cart.length === 0) { %>
  <div class="w-full flex flex-col items-center justify-center">
    <h3 class="text-2xl mt-4">Your cart is empty</h3>
    <img
      class="w-1/3 mx-auto"
      src="/images/img-emptyCart.jpg"
      alt="Empty Cart"
    />  
</div>


<% } else { %>
<div class="w-full h-auto px-20 py-10">
  <h2 class="text-3xl mb-5">Shopping Cart</h2>
  <div class="flex flex-col gap-1">
    <% let totalPrice = 0.00; %>
    <% let Subtotal = 0; %>

    <% user.cart.forEach(function (product) { %>
      <% Subtotal += product.quantity %>
    <div class="flex items-start justify-between gap-5 border-b pb-1">
      <!-- Product Image -->
      <div class="w-1/6">
        <img
          class="object-contain bg-[<%= product.rid.bgcolor %>]"
          src="data:image/jpeg;base64,<%= product.rid.image.toString('base64') %>"
          alt="Product Image"
        />
      </div>

      <!-- Product Details -->
      <div class="flex-1">
        <h3 class="text-lg font-medium"><%= product.rid.name %></h3>
        <p class="text-green-600 text-sm mt-1">In stock</p>
        <p class="text-gray-500 mt-1">Size: <%= product.rid.size %></p>
        <p class="text-gray-500">Colour: <%= product.rid.color %></p>
      </div>

      <!-- Quantity and Actions -->
      <div class="flex items-center gap-2">
        <a href="/removefromcart/<%= product.rid._id %>" class="w-8 h-8 bg-gray-200 flex rounded-full items-center justify-center ri-subtract-line"></a>
        <div class="px-3 py-1 rounded-md bg-gray-100 text-black"><%= product.quantity %></div>
        <a href="/addfromcart/<%= product.rid._id %>" class="w-8 h-8 bg-gray-200 flex rounded-full items-center justify-center ri-add-line"></a>
      </div>

      <!-- Product Price -->
      <div class="text-lg font-medium">
        <p>MRP : ₹ <%= product.rid.price.toFixed(2) %></p>
        <p>Discount: <%= product.rid.discount %>%</p>
        <% let discountedPrice = product.rid.price * (1 - product.rid.discount / 100); %>
        <% totalPrice += discountedPrice * product.quantity; %>
        <p>Discounted Price: ₹ <%= (discountedPrice * product.quantity).toFixed(2) %></p>
      </div>
    </div>
    <% }); %>
  </div>

  <!-- Subtotal Section -->
  <div class="flex flex-col justify-end items-end mt-10">
    <div class="flex justify-between w-1/3">
      <h3 class="text-lg font-medium">Subtotal (<%= Subtotal %> items):</h3>
      <h3 class="text-lg font-semibold">₹ <%= totalPrice.toFixed(2) %></h3>
    </div>
    <div class="flex justify-between w-1/3 mt-4 border-t pt-4">
      <h3 class="text-xl font-medium">Total Amount:</h3>
      <h3 class="text-xl font-semibold text-green-600">
        ₹ <%= totalPrice.toFixed(2) %>
      </h3>
    </div>
  </div>
</div>
<% } %>

<%- include('./partials/footer') %>
